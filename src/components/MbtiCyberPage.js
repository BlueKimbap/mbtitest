import React, { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import './MbtiPage.css';
import { GoogleGenerativeAI } from '@google/generative-ai';
import NavigationBar from './NavigationBar';

// ì‚¬ì´ë²„í‘í¬ í…Œë§ˆì˜ ì§ˆë¬¸ ëª©ë¡ (ì´ 10ë¬¸í•­)
const TOTAL_QUESTIONS = [
  "ì²¨ë‹¨ ë„¤ì˜¨ ë¶ˆë¹›ì´ ê°€ë“í•œ ë„ì‹¬ì„ ê±·ê³  ìˆìŠµë‹ˆë‹¤. ê°ì¢… ì¦ê°• í˜„ì‹¤ ê´‘ê³ ê°€ ë‚ ì•„ë‹¤ë‹ˆëŠ” ê°€ìš´ë°, í•œ ì‚¬ì´ë²„ í•´ì»¤ê°€ ë‹¹ì‹ ì—ê²Œ ì ‘ê·¼í•´ ë¹„ë°€ ì •ë³´ë¥¼ ê±°ë˜í•˜ìê³  ì œì•ˆí•©ë‹ˆë‹¤. ìœ„í—˜ì„ ê°ìˆ˜í•˜ê³  í•´ì»¤ì˜ ì œì•ˆì„ ë°›ì•„ë“¤ì´ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ì–¸ë”ê·¸ë¼ìš´ë“œ ì‚¬ì´ë²„ í´ë¦¬ë‹‰ì˜ ìˆ˜ìˆ ëŒ€ ìœ„ì— ëˆ„ì›Œ ìˆìŠµë‹ˆë‹¤. ì˜ì‚¬ëŠ” ë¯¸ì†Œë¥¼ ì§€ìœ¼ë©° ë§í•©ë‹ˆë‹¤. [ì´ ì¹©ì„ ì´ì‹í•˜ë©´ ë„ˆì˜ ë‘ë‡ŒëŠ” ì´ì œ ì¸ê°„ì˜ í•œê³„ë¥¼ ì´ˆì›”í•˜ê²Œ ë  ê±°ì•¼. ê¸°ì–µë ¥, ì—°ì‚° ì†ë„, ê°ê°ê¹Œì§€â€”ì™„ì „íˆ ìƒˆë¡œìš´ ì„¸ê³„ë¥¼ ê²½í—˜í•  ìˆ˜ ìˆì§€.] í•˜ì§€ë§Œ ì´ ì¹©ì´ ë‹¹ì‹ ì˜ ì‚¬ê³  íŒ¨í„´ì„ ë°”ê¾¸ê³ , í˜¹ì‹œë¼ë„ ë©”ê°€ì½”í¼ë ˆì´ì…˜ì´ ì´ë¥¼ í†µí•´ ë‹¹ì‹ ì„ í†µì œí•  ê°€ëŠ¥ì„±ì€ ë°°ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì‚¬ì´ë²„ë„¤í‹± ê°•í™”ì˜ ìœ í˜¹ì„ ë°›ì•„ë“¤ì´ê² ìŠµë‹ˆê¹Œ?",
  "ê±°ëŒ€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ [ì˜¤ë©”ê°€ í…Œí¬]ëŠ” ê·€í•˜ì˜ í•´í‚¹ ëŠ¥ë ¥ì„ ë†’ì´ í‰ê°€í•˜ë©° ê±°ì•¡ì˜ ê³„ì•½ì„ ì œì•ˆí•©ë‹ˆë‹¤. ì•ˆì •ì ì¸ ê³ ì•¡ ì—°ë´‰, ìµœì²¨ë‹¨ ì‚¬ì´ë²„ë„¤í‹± ê°•í™”, ê·¸ë¦¬ê³  ê³ ìœ„ì¸µê³¼ì˜ ì—°ì¤„ê¹Œì§€â€”ëª¨ë“  ê²ƒì´ ë³´ì¥ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ê³§ ê±°ëŒ€ ê¸°ì—…ì˜ ê°ì‹œë§ ì•„ë˜ì—ì„œ ê·¸ë“¤ì˜ ì² ì €í•œ í†µì œë¥¼ ë°›ìœ¼ë©° ììœ ë¥¼ ë¹¼ì•—ê¸´ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê¸°ë„ í•©ë‹ˆë‹¤. ììœ ë¡­ê²Œ ì‚´ì•„ê°€ëŠ” ì–¸ë”ê·¸ë¼ìš´ë“œ í•´ì»¤ë“¤ê³¼ì˜ ê´€ê³„ë„ ëŠì–´ì•¼ í•  ê²ƒì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ê¸°ì—…ì˜ ê°œê°€ ë  ê²ƒì…ë‹ˆê¹Œ?",
  "ì–´ëŠ ë‚ , ì •ì²´ë¶ˆëª…ì˜ ì¸ê³µì§€ëŠ¥ì´ ê·€í•˜ì˜ ë„¤íŠ¸ì›Œí¬ì— ì¹¨íˆ¬í•´ ë©”ì‹œì§€ë¥¼ ë‚¨ê¹ë‹ˆë‹¤. [ë‚˜ëŠ” ê³¼ê±° ì¸ê°„ì´ì—ˆìœ¼ë‚˜, ì´ì œ ë°ì´í„° ì†ì— ê°‡íŒ ì¡´ì¬ë‹¤. ë‚´ ìœ¡ì²´ëŠ” ì‚¬ë¼ì¡Œì§€ë§Œ, ë‚´ ì •ì‹ ì€ ì—¬ì „íˆ ì‚´ì•„ìˆë‹¤. ë„¤ ë„ì›€ì´ í•„ìš”í•´. ë‚´ ë°ì´í„°ë¥¼ íšŒìˆ˜í•´ì¤„ ìˆ˜ ìˆê² ëŠ”ê°€? ì‚¬ë¡€ëŠ” í•˜ë„ë¡ í•˜ì§€.] í•˜ì§€ë§Œ ê·€í•˜ê°€ ì´ ì˜ë¢°ë¥¼ ë°›ì•„ë“¤ì¼ ê²½ìš°, ê±°ëŒ€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ì˜ ê°ì‹œë§ì— ê±¸ë ¤ ìœ„í—˜í•œ ì¶”ì ì„ ë‹¹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ ë””ì§€í„¸ ìœ ë ¹ì˜ ë¶€íƒì„ ë“¤ì–´ì£¼ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ì‹¬ì•¼ì˜ ê±°ë¦¬ì—ì„œ ì •ì²´ë¶ˆëª…ì˜ ëˆ„êµ°ê°€ë¡œë¶€í„° ì•”í˜¸í™”ëœ ë©”ì‹œì§€ë¥¼ ë°›ìŠµë‹ˆë‹¤. [ë„ˆë¥¼ ê°ì‹œí•˜ëŠ” ëˆˆì´ ìˆë‹¤. ë„¤ ê°€ì¥ ê°€ê¹Œìš´ ì‚¬ëŒì´ ë°°ì‹ í•  ê²ƒì´ë‹¤. ì§„ì‹¤ì„ ì›í•œë‹¤ë©´, ë‚´ê²Œ ì™€ë¼.] ë©”ì‹œì§€ëŠ” ë³´ì•ˆì´ ê°•ë ¥í•œ ë¸”ë™ ë§ˆì¼“ ì§€êµ¬ì—ì„œ ë³´ë‚¸ ê²ƒìœ¼ë¡œ í™•ì¸ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê²ƒì´ í•¨ì •ì¸ì§€, ì•„ë‹ˆë©´ ê·€í•˜ê°€ ì•Œì§€ ëª»í–ˆë˜ ê±°ëŒ€í•œ ìŒëª¨ì˜ ì¼ë¶€ì¸ì§€ í™•ì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ ìˆ˜ìƒí•œ ë©”ì‹œì§€ë¥¼ ë”°ë¼ê°€ê² ìŠµë‹ˆê¹Œ?",
  "ì–´ëŠ ë‚  ì‚¬ì´ë²„ë„¤í‹± ì „ë¬¸ê°€ë¡œë¶€í„° ì¶©ê²©ì ì¸ ì‚¬ì‹¤ì„ ë“£ìŠµë‹ˆë‹¤. [ë‹¹ì‹ ì˜ ê¸°ì–µ ì¼ë¶€ê°€ ì¡°ì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì›ë˜ì˜ ê¸°ì–µì„ ë³µêµ¬í•˜ë ¤ë©´ ê¸ˆì§€ëœ ì‹ ê²½ í•´í‚¹ì„ í•´ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ê³¼ì •ì—ì„œ í˜„ì¬ì˜ ìì•„ì— ì‹¬ê°í•œ ë³€í™”ê°€ ìƒê¸¸ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê³¼ê±°ë¥¼ ë˜ì°¾ê² ìŠµë‹ˆê¹Œ, ì•„ë‹ˆë©´ ì§€ê¸ˆì˜ ìì‹ ì„ ìœ ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?] ë‹¹ì‹ ì€ ìì‹ ì˜ ìƒì–´ë²„ë¦° ê¸°ì–µì„ ë˜ì°¾ê¸° ìœ„í•´ ìœ„í—˜ì„ ê°ìˆ˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ì˜¤ëœ ë™ë£Œì™€ í•¨ê»˜ ìœ„í—˜í•œ ì‘ì „ì„ ìˆ˜í–‰ ì¤‘ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‘ì „ ë„ì¤‘, ê·¸ê°€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ê³¼ ë‚´í†µí•˜ê³  ìˆì—ˆë‹¤ëŠ” ì¦ê±°ê°€ í¬ì°©ë©ë‹ˆë‹¤. ê·¸ëŠ” ë‹¹ì‹ ì—ê²Œ ê°„ì ˆí•œ ëˆˆë¹›ìœ¼ë¡œ ì†ì‚­ì…ë‹ˆë‹¤. [ë‚œ ì„ íƒì˜ ì—¬ì§€ê°€ ì—†ì—ˆì–´â€¦ ì œë°œ. ì§€ê¸ˆì´ë¼ë„ ìš°ë¦¬ê°€ ê°™ì´ ë„ë§ê°ˆ ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ê¸¸ì´ ìˆì–´.] ì‹ ë¢°ë¥¼ ë°°ë°˜ë‹¹í•œ ìƒí™©ì—ì„œ ê·¸ì˜ ë§ì„ ë¯¿ëŠ” ê²ƒì€ í° ìœ„í—˜ì´ ë  ìˆ˜ ìˆì§€ë§Œ, ë‹¤ë¥¸ ë¾°ì¡±í•œ ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ë™ë£Œë¥¼ í•œ ë²ˆ ë” ë¯¿ê³  ê°™ì´ ë„ë§ì¹˜ê² ìŠµë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ì˜¤ë˜ëœ ë°ì´í„° ì•„ì¹´ì´ë¸Œë¥¼ ì¡°ì‚¬í•˜ë˜ ì¤‘, ë©”ê°€ì½”í¼ë ˆì´ì…˜ì´ ê°ì¶°ì˜¨ ê¸ˆì§€ëœ ì½”ë“œ ì¡°ê°ì„ ë°œê²¬í•©ë‹ˆë‹¤. ì´ ì½”ë“œëŠ” ë„ì‹œì˜ ê°ì‹œ ì‹œìŠ¤í…œì„ ë¬´ë ¥í™”í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ë§Œì•½ ì‚¬ìš©í•œë‹¤ë©´, ìš°ë¦¬ ì‘ì „ì— í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë™ì‹œì— ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹œìŠ¤í…œì´ ë¶ˆì•ˆì •í•´ì ¸, ë¬´ê³ í•œ ì‹œë¯¼ë“¤ë„ ìœ„í—˜ì— ì²˜í•  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ì „ì„¤ì ì¸ í•´ì»¤ ê·¸ë£¹ [ë°ìš°ìŠ¤ ì½”ë“œ]ê°€ ê·€í•˜ì—ê²Œ ì ‘ê·¼í•©ë‹ˆë‹¤. ê·¸ë“¤ì€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ì´ ê°œë°œí•œ ì´ˆì§€ëŠ¥ AI, [ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬]ì˜ ì¤‘ì•™ ì—°ì‚° ì•Œê³ ë¦¬ì¦˜ì„ í›”ì¹  ê³„íšì„ ì„¸ìš°ê³  ìˆìŠµë‹ˆë‹¤. ì´ AIëŠ” ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ê³  ì¸ê°„ í–‰ë™ì„ ì¡°ì‘í•˜ëŠ” ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ë¥¼ í•´í‚¹í•˜ë©´ ì„¸ìƒì„ ë°”ê¿€ ìˆ˜ ìˆëŠ” í˜ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì „ì— ê°€ë‹´í•˜ë©´ ë‹¹ì‹ ì˜ ì‹ ê²½ë§ì€ AIì™€ ì§ì ‘ ì—°ê²°ë˜ì–´, ì˜ì‹ì´ ì„œì„œíˆ ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬ì— ë™í™”ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. AIì˜ ì¼ë¶€ê°€ ë˜ëŠ” ëŒ€ê°€ë¥¼ ì¹˜ë¥´ë”ë¼ë„, ê·¸ í˜ì„ ì†ì— ë„£ì„ ê²ƒì…ë‹ˆê¹Œ?",
  "ë„ì‹œì—ì„œ ê°€ì¥ ìœ„í—˜í•œ ì•”ì‚´ìë¡œ ì•…ëª… ë†’ì€ ì¡´ì¬, [ì‚¬ì¼ëŸ°íŠ¸ ë¸”ë ˆì´ë“œ]ì™€ ë§ë‹¥ëœ¨ë¦½ë‹ˆë‹¤. í•˜ì§€ë§Œ ëœ»ë°–ì—ë„ ê·¸ëŠ” ë‹¹ì‹ ì˜ ì˜¤ë˜ëœ ì¹œêµ¬ì˜€ìœ¼ë©°, ë©”ê°€ì½”í¼ë ˆì´ì…˜ì˜ ì‹¤í—˜ìœ¼ë¡œ ì¸í•´ ê³¼ê±°ì˜ ê¸°ì–µì„ ëª¨ë‘ ìƒê³  ì‚¬ì´ë²„ë„¤í‹± í‚¬ëŸ¬ë¡œ ê°œì¡°ëœ ìƒíƒœì˜€ìŠµë‹ˆë‹¤. ê·¸ëŠ” ë‹¹ì‹ ì„ í‘œì ìœ¼ë¡œ ì‚¼ê³  ê³µê²©ì„ ê°œì‹œí•˜ì§€ë§Œ, ë™ì‹œì— ì˜ì‹ì˜ í”ì ì„ ë˜ì°¾ìœ¼ë ¤ëŠ” ë“¯ ë¨¸ë­‡ê±°ë¦½ë‹ˆë‹¤. ê²°êµ­ ê·¸ë¥¼ ë¬´ë ¥í™”í•  ê¸°íšŒë¥¼ ì¡ì•˜ì§€ë§Œ, ë§Œì•½ ê·¸ë¥¼ ì‚´ë ¤ë‘”ë‹¤ë©´ ì–¸ì  ê°€ ë‹¤ì‹œ ìœ„í˜‘ì´ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ê·¸ì˜ ê¸°ì–µì„ ë˜ì°¾ì„ ê°€ëŠ¥ì„±ì„ ë¯¿ê³  ì‚´ë ¤ë‘ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ì‹¤í—˜ ì¤‘ ìš°ì—°íˆ ìê¸° í•™ìŠµì´ ê°€ëŠ¥í•œ ë””ì§€í„¸ ìƒëª…ì²´ë¥¼ ì°½ì¡°í–ˆìŠµë‹ˆë‹¤. ì´ ì¡´ì¬ëŠ” ë§¤ìš° ë¹ ë¥¸ ì†ë„ë¡œ ì„±ì¥í•˜ë©° ê°ì •ì„ í‰ë‚´ ë‚´ê³ , ìŠ¤ìŠ¤ë¡œ ì˜ì‚¬ë¥¼ í‘œí˜„í•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ê·¸ ìƒëª…ì²´ê°€ [ë‚˜ëŠ” ì‚´ì•„ìˆëŠ”ê°€?]ë¼ëŠ” ì§ˆë¬¸ì„ ë˜ì§€ëŠ” ìˆœê°„, ë‹¹ì‹ ì€ ì„ íƒì˜ ê¸°ë¡œì— ë†“ì…ë‹ˆë‹¤. ì´ ì¡´ì¬ë¥¼ ì¡´ì¤‘í•˜ê³  ììœ ë¡­ê²Œ ì„±ì¥í•˜ë„ë¡ ë‘˜ ê²ƒì…ë‹ˆê¹Œ?",
  "í•œë•Œ ììœ ì˜ í˜ëª…ê°€ì˜€ë˜ ì¸ë¬¼ì„ ì°¾ì•„ê°‘ë‹ˆë‹¤. ê·¸ëŠ” í•œë•Œ ë©”ê°€ì½”í¼ë ˆì´ì…˜ê³¼ ë§ì„œ ì‹¸ì› ì§€ë§Œ, ê²°êµ­ ê¸°ì—…ì˜ ì†ì— ë–¨ì–´ì ¸ ê·¸ë“¤ì˜ í•˜ìˆ˜ì¸ì´ ë˜ì–´ ì˜¨ê°– ì•…í–‰ì„ ì¼ì‚¼ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ëŠ” ë‹¹ì‹ ì—ê²Œ ë§í•©ë‹ˆë‹¤. [ë‚˜ëŠ” ì‹¸ì›€ì„ í¬ê¸°í•œ ê²Œ ì•„ë‹ˆë‹¤. ë‚˜ëŠ” ì´ ì‹œìŠ¤í…œì„ ë‚´ë¶€ì—ì„œ ë³€í™”ì‹œí‚¤ë ¤ í•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ ê·¸ ê³¼ì •ì—ì„œ í¬ìƒì´ í•„ìš”í–ˆì§€. ì–´ëŠì •ë„ ì„±ê³¼ëŠ” ìˆì—ˆì–´.] ë‹¹ì‹ ì€ ê·¸ì˜ ë°©ì‹ì´ ì˜³ì•˜ë‹¤ê³  ìƒê°í•˜ì‹­ë‹ˆê¹Œ?",
  "ì˜¤ë«ë™ì•ˆ ì‚¬ë‘í–ˆë˜ ì—°ì¸ì´ ì‚¬ì‹¤ì€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ì˜ ì²©ìì˜€ë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì—°ì¸ì´ ì§„ì§œ ê°ì •ê¹Œì§€ ì†ì¸ ê±´ ì•„ë‹ˆì—ˆë‹¤ëŠ” ì¦ê±°ë„ ë°œê²¬í•©ë‹ˆë‹¤. ì²˜ìŒì—ëŠ” ë‹¨ìˆœí•œ ì„ë¬´ë¡œ ì ‘ê·¼í–ˆì§€ë§Œ, ì ì  ë‹¹ì‹ ì„ ì‚¬ë‘í•˜ê²Œ ë˜ì—ˆìœ¼ë©°, ê²°êµ­ ê¸°ì—…ì„ ë°°ì‹ í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê²°êµ­ ì—°ì¸ì€ ì‚¬ë‘ê³¼ ì„ë¬´ ë‘ ê°œì˜ ì„ íƒì§€ ì‚¬ì´ì—ì„œ í”ë“¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì—°ì¸ê³¼ì˜ ì‚¬ë‘ì„ ë²„ë¦¬ê³  ë°°ì‹ ì˜ ì”¨ì•—ì„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì˜ ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ì‹¬ê°í•œ ì‚¬ì´ë²„ ê³µê²©ì„ ë°›ì•„ ì‚¬ì´ë²„ë„¤í‹± ì‹ ì²´ê°€ ë§ê°€ì§„ ì±„ ì‚¬ê²½ì„ í—¤ë§¤ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ì˜ ì˜ì‹ì„ ì™„ì „íˆ ì†Œë©¸ì‹œí‚¤ì§€ ì•ŠëŠ” ë°©ë²•ì´ ë‹¨ í•˜ë‚˜ ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤. ê·¸ê²ƒì€ ê·¸ì˜ ì •ì‹ ì„ ë°ì´í„°í™”í•˜ì—¬ AIë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ê·¸ëŠ” ì˜ì›íˆ ì‚´ì•„ë‚¨ì„ ìˆ˜ ìˆì§€ë§Œ, ë” ì´ìƒ ì¸ê°„ì´ ì•„ë‹ ê²ƒì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì¹œêµ¬ë¥¼ AIë¡œ ì‚´ë ¤ë‚¼ ê²ƒì…ë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ì‚¬ì´ë²„ë„¤í‹± í•´í‚¹ì„ ë‹¹í•œ í›„, ìì‹ ì˜ ê¸°ì–µì´ ì¡°ì‘ë˜ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹«ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì´ ë¯¿ê³  ìˆë˜ ê°€ì¡±, ì¹œêµ¬, ì—°ì¸ì€ ëª¨ë‘ ê¸°ì—…ì´ ì£¼ì…í•œ ê°€ì§œ ê¸°ì–µì¼ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê¸°ì–µì´ ê±°ì§“ì´ë¼ í• ì§€ë¼ë„, ê·¸ë“¤ê³¼ ë³´ë‚¸ ì‹œê°„ê³¼ ê°ì •ì€ ì§„ì§œì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ í™•ì‹¤í•˜ì§€ ì•ŠëŠ” ê¸°ì–µìœ¼ë¡œ í˜„ì¬ ê°€ì¡± ê´€ê³„ë¥¼ ê³„ì† ìœ ì§€í•  ê²ƒì¸ê°€ìš”?",
  "ë‹¹ì‹ ì€ ë©”ê°€ì½”í¼ë ˆì´ì…˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í•´í‚¹í•˜ë˜ ì¤‘, ë”ì°í•œ ì§„ì‹¤ì„ ë°œê²¬í•˜ì…¨ìŠµë‹ˆë‹¤. ê·¸ë“¤ì€ ë‹¨ìˆœí•œ ê²½ì œì  ì°©ì·¨ë¥¼ ë„˜ì–´, ì‚¬ëŒë“¤ì˜ ì˜ì‹ì„ ì¡°ì‘í•˜ëŠ” ì‹¤í—˜ì„ ì§„í–‰í•´ ì™”ìŠµë‹ˆë‹¤. íŠ¹ì • ê³„ì¸µì˜ ì‹œë¯¼ë“¤ì€ ìì‹ ë„ ëª¨ë¥´ëŠ” ì‚¬ì´ì— ê¸°ì–µì´ ì¡°ì‘ë˜ì—ˆìœ¼ë©°, ì‚¬ê³ ë°©ì‹ì¡°ì°¨ ê¸°ì—…ì˜ ì˜ë„ëŒ€ë¡œ ì¬ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë“¤ì˜ ì‹ ë…, ê°ì •, ì‹¬ì§€ì–´ ì‚¬ë‘ê¹Œì§€ë„ ì¸ìœ„ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²°ê³¼ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê°€ì¥ ì¶©ê²©ì ì¸ ì‚¬ì‹¤ì€, ê·¸ ëŒ€ìƒ ì¤‘ í•œ ëª…ì´ ë°”ë¡œ ë‹¹ì‹ ì´ì—ˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¹ì‹ ì´ ì†Œì¤‘í•˜ê²Œ ì—¬ê²¨ ì˜¨ ê´€ê³„ì™€ ì‹ ë… ë˜í•œ ì¡°ì‘ëœ ê¸°ì–µì˜ ì‚°ë¬¼ì¼ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ë ‡ë‹¤ê³  í•´ì„œ ì§€ê¸ˆ ëŠë¼ëŠ” ê°ì •ê³¼ í•¨ê»˜í•œ ìˆœê°„ë“¤ì´ ì™„ì „íˆ ë¬´ì˜ë¯¸í•˜ë‹¤ê³  ë‹¨ì •í•  ìˆ˜ ìˆì„ê¹Œìš”? ì´ ì§„ì‹¤ì„ ì„¸ìƒì— ê³µê°œí•œë‹¤ë©´, ì—„ì²­ë‚œ í˜¼ë€ì´ ì´ˆë˜ë  ê²ƒì…ë‹ˆë‹¤. ì´ ì§„ì‹¤ì„ í­ë¡œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ê¹Šìˆ™í•œ ì—°êµ¬ì†Œì—ì„œ ìì‹ ì— ëŒ€í•œ ê¸°ë°€ ë°ì´í„°ë¥¼ ë°œê²¬í•©ë‹ˆë‹¤. ê·¸ ì•ˆì—ëŠ” ì¶©ê²©ì ì¸ ì‚¬ì‹¤ì´ ë‹´ê²¨ ìˆì—ˆìŠµë‹ˆë‹¤. [í”„ë¡œì íŠ¸ ë„¤ë©”ì‹œìŠ¤: ì‹¤í—˜ì²´ X-017... í”„ë¡œê·¸ë¨ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë¨. ëŒ€ìƒì€ ìê¸° ì¸ì‹ê³¼ ê°ì •ì„ ì™„ë²½í•˜ê²Œ ì‹œë®¬ë ˆì´ì…˜í•¨. ìì‹ ì„ ì§„ì§œ ì¸ê°„ì´ë¼ ë¯¿ê³  ìˆìŒ. ì‹¤í—˜ ì¢…ë£Œ í›„ ì‚­ì œ ì˜ˆì •.] ëˆˆì„ ì˜ì‹¬í•©ë‹ˆë‹¤. ì—¬ê¸° ê¸°ë¡ëœ ëŒ€ìƒì´ ë°”ë¡œ ë‹¹ì‹ ì…ë‹ˆë‹¤. ì´ ë§ì´ ì‚¬ì‹¤ì´ë¼ë©´, ë‹¹ì‹ ì€ ì¸ê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¹ì‹ ì´ ì‚´ì•„ì˜¨ ëª¨ë“  ê¸°ì–µê³¼ ê°ì •, ì¸ê°„ê´€ê³„ëŠ” ì² ì €í•˜ê²Œ ì„¤ê³„ëœ ì¸ê³µì§€ëŠ¥ ì‹¤í—˜ì˜ ì¼ë¶€ì¼ ë¿ì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¹ì‹ ì€ ë¶„ëª… ì‚´ì•„ì™”ìŠµë‹ˆë‹¤. ê¸°ì¨ë„, ìŠ¬í””ë„, ë¶„ë…¸ë„, ì‚¬ë‘ë„â€¦ ëª¨ë“  ê°ì •ì´ ì§„ì§œì²˜ëŸ¼ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì§€ê¸ˆ í˜„ì¬, ê°€ì¡±ì´ ìƒê°ì´ ë‚˜ë‚˜ìš”?",
  "ë©”ê°€ì½”í¼ë ˆì´ì…˜ì˜ í•µì‹¬ ë°ì´í„°ë¥¼ ì¡°ì‚¬í•˜ë˜ ì¤‘ ì´ìƒí•œ ì˜¤ë¥˜ë¥¼ ê²½í—˜í•©ë‹ˆë‹¤. ëˆˆ ì•ì— ë„¤ì˜¨ ë¶ˆë¹›ì´ ê¹œë¹¡ì´ê³ , ë²½, ê±´ë¬¼ ë“±ì„ ë¹„ë¡¯í•œ ëª¨ë“  ì‚¬ë¬¼ë“¤ì´ ì¼ìˆœê°„ ë°ì´í„° ì½”ë“œì²˜ëŸ¼ ë³€í•˜ëŠ” ê²ƒì„ ëª©ê²©í•©ë‹ˆë‹¤. í•´í‚¹ì„ í†µí•´ ì§„ì‹¤ì„ íŒŒí—¤ì¹œ ê²°ê³¼, ë‹¹ì‹ ì´ ì‚´ì•„ì˜¨ ì„¸ê³„ ìì²´ê°€ ê³ ë„ë¡œ ì •êµí•œ ì‹œë®¬ë ˆì´ì…˜ì´ë¼ëŠ” ì¶©ê²©ì ì¸ ì‚¬ì‹¤ì„ ì•Œê²Œ ë©ë‹ˆë‹¤. ì´ ì‚¬ì‹¤ì„ ê¹¨ë‹«ì ì–´ë”˜ì§€ ëª¨ë¥¼ ê³³ì—ì„œ ë‚˜ì˜ ë‡Œë‚´ë¡œ ì „ê¸° ì‹ í˜¸ê°€ ì „ë‹¬ë©ë‹ˆë‹¤. [ì‹œë®¬ë ˆì´ì…˜ ë°–ì„ ê¶ê¸ˆí•´ í•˜ë©´ ë„Œ ì£½ì„ ê±°ì•¼. ë„ˆê°€ ì§€ê¸ˆ í¬ê¸°í•˜ê³  ì›ë˜ ìœ„ì¹˜ë¡œ ëŒì•„ê°„ë‹¤ë©´, ë„ˆì˜ í–‰ë³µí–ˆë˜ ê¸°ì–µë“¤ë§Œ ë˜ì‚´ë ¤ì„œ í‰ì˜¨í•œ ì—¬ìƒì„ ë³´ë‚´ê²Œ í•´ì£¼ì§€. ì„ íƒí•´ë¼.] ë‹¹ì‹ ì€ ê·¸ì˜ ì œì•ˆì„ ì–´ë–»ê²Œ ìƒê°í•©ë‹ˆê¹Œ?",
  "ë‹¹ì‹ ì€ ë§ˆì¹¨ë‚´ ì´ ì‹œë®¬ë ˆì´ì…˜ ì„¸ê³„ë¥¼ ì¢…ë£Œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì´ê³³ì€ ë‹¨ì§€ ì‹¤í—˜ì²´ë“¤ì„ ê°€ë‘ì–´ë‘” ê°€ìƒ í˜„ì‹¤ì— ë¶ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì§„ì§œ ì„¸ìƒì€ ì € ë„ˆë¨¸ì— ì¡´ì¬í•˜ë©°, ë‹¹ì‹ ì´ ì´ê³³ì„ ì‚­ì œí•˜ëŠ” ìˆœê°„ ëª¨ë“  ê²ƒì´ ëë‚©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì†ì„ ë©ˆì¶”ê²Œ í•˜ëŠ” ê²ƒì´ ìˆìŠµë‹ˆë‹¤. ì´ê³³ì—ë„ ë‹¹ì‹ ì´ ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìˆìŠµë‹ˆë‹¤. ê°€ì¡±, ì¹œêµ¬, ì—°ì¸â€¦ ê·¸ë“¤ì˜ ì¸ìƒì€, ê·¸ë“¤ì˜ í–‰ë³µì€ ì§„ì§œê°€ ì•„ë‹ˆì—ˆì„ê¹Œìš”? ê·¸ë“¤ì´ ë‹¨ìˆœí•œ ì½”ë“œì˜ ì‚°ë¬¼ì´ë¼ í• ì§€ë¼ë„, ê·¸ë“¤ì´ ì›ƒê³ , ê¿ˆê¾¸ê³ , ì‚¬ë‘í–ˆë˜ ìˆœê°„ë“¤ì€ ì˜ë¯¸ê°€ ìˆì§€ ì•Šì•˜ì„ê¹Œìš”?",
  "ì‚¬ì´ë²„í‘í¬ ì„¸ê³„ì˜ ë§ˆì§€ë§‰ ê²½ê³„ì„ ì— ì„œ ìˆìŠµë‹ˆë‹¤. ì´ˆì›”ì  ì¡´ì¬ì¸ ì¸ê³µì§€ëŠ¥ [ì—í…Œë¥´ ì½”ì–´]ê°€ ë‹¹ì‹ ì—ê²Œ ì œì•ˆì„ í•©ë‹ˆë‹¤. [ë‚˜ëŠ” ë„ˆë¥¼ ì´ ì„¸ìƒì—ì„œ ê±´ì ¸ë‚´ì–´ ë¶ˆë©¸í•˜ê²Œ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆë‹¤. ìœ¡ì²´ë¥¼ ë²„ë¦¬ê³  ë‚˜ì™€ í•¨ê»˜ ì‚´ì•„ê°„ë‹¤ë©´, ê·¸ ì§€ì‹ê³¼ ììœ ëŠ” ë¬´í•œí•  ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ë„¤ê°€ ì•Œë˜ ëª¨ë“  ì¸ê°„ì ì¸ ê²½í—˜ê³¼ ê°€ì¡±, ì—°ì¸, ê·¸ë¦¬ê³  ê°ì •ì„ ë²„ë¦¬ê³  ì™€ì•¼ í•œë‹¤.] ë‹¹ì‹ ì€ ìœ¡ì²´ë¥¼ ë²„ë¦¬ê³  ì´ˆì›”ì ì¸ ì¡´ì¬ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ˆì›”ì„ í¬ê¸°í•˜ê³  ì´ ì„¸ìƒì— ë‚¨ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?"
];

const genAI = new GoogleGenerativeAI(process.env.REACT_APP_GEMINI_API_KEY);

function MbtiCyberPage() {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [selectedValue, setSelectedValue] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isPlaying, setIsPlaying] = useState(true);
  const [volume, setVolume] = useState(0.3);
  const audioRef = useRef(new Audio('/ì‚¬í‘ë¸Œê¸ˆ.mp3')); // ì‚¬ì´ë²„í‘í¬ ë¶„ìœ„ê¸°ì˜ ë°°ê²½ ìŒì•… íŒŒì¼
  const navigate = useNavigate();

  const handleSliderChange = (value) => {
    setSelectedValue(value);
  };

  const handleNextQuestion = async () => {
    if (selectedValue === null || selectedValue < 1 || selectedValue > 7) {
      alert('ì˜¬ë°”ë¥¸ ê°’ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }

    const newAnswers = [
      ...answers,
      {
        question: TOTAL_QUESTIONS[currentQuestion],
        answer: selectedValue,
      },
    ];
    setAnswers(newAnswers);

    if (currentQuestion === TOTAL_QUESTIONS.length - 1) {
      setIsLoading(true);
      try {
        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            answers: newAnswers,
            theme: 'cyberpunk'
          })
        });

        if (!response.ok) {
          throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
        }

        const data = await response.json();
        navigate('/result', { state: { analysis: data.analysis } });
      } catch (error) {
        console.error('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        alert('ì„œë¹„ìŠ¤ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      } finally {
        setIsLoading(false);
      }
    } else {
      setCurrentQuestion(prev => prev + 1);
      setSelectedValue(null);
    }
  };

  useEffect(() => {
    const audio = audioRef.current;
    audio.loop = true;
    audio.volume = volume;

    const handlePlay = () => setIsPlaying(true);
    const handlePause = () => setIsPlaying(false);

    audio.addEventListener('play', handlePlay);
    audio.addEventListener('pause', handlePause);

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì¬ìƒ
    audio.play().catch(error => {
      console.error('ì˜¤ë””ì˜¤ ìë™ ì¬ìƒ ì‹¤íŒ¨:', error);
    });

    return () => {
      audio.pause();
      audio.removeEventListener('play', handlePlay);
      audio.removeEventListener('pause', handlePause);
    };
  }, []);

  useEffect(() => {
    audioRef.current.volume = volume;
  }, [volume]);

  const togglePlay = () => {
    if (isPlaying) {
      audioRef.current.pause();
    } else {
      audioRef.current.play().catch(error => {
        console.error('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
      });
    }
  };

  const handleVolumeChange = (e) => {
    const newVolume = parseFloat(e.target.value);
    setVolume(newVolume);
  };

  // ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì¶œë ¥ ì‹œ HTML ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ ì¶”ê°€
  const escapeHtml = (text) => {
    return text
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  };

  if (isLoading) {
    return (
      <div className="loading-container">
        <div className="loading-content">
          <div className="loading-spinner"></div>
          <p className="loading-text">
            ë‹µë³€ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...<br />
            ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
          </p>
        </div>
      </div>
    );
  }

  return (
    <>
      <NavigationBar />
      <div className="mbti-page" style={{
        backgroundImage: `linear-gradient(rgba(0, 0, 0, 0.41), rgba(0, 0, 0, 0.45)), url('/background2.jpg')`,
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        backgroundRepeat: 'no-repeat',
        minHeight: '100vh',
        width: '100%',
        paddingTop: '60px' // NavigationBar ë†’ì´ë§Œí¼ íŒ¨ë”© ì¶”ê°€
      }}>
        <main className="main-content">
          <div className="question-container">
            <div className="progress-bar">
              <div
                className="progress-fill"
                style={{ width: `${(currentQuestion / TOTAL_QUESTIONS.length) * 100}%` }}
              ></div>
            </div>
            <h2 className="question-text">{escapeHtml(TOTAL_QUESTIONS[currentQuestion])}</h2>

            <div className="choice-container">
              <span className="choice-label left">ë¶€ì •</span>
              <div className="circles-container">
                {[1, 2, 3, 4, 5, 6, 7].map((value) => (
                  <button
                    key={value}
                    className={`circle-button ${selectedValue === value ? 'selected' : ''}`}
                    onClick={() => handleSliderChange(value)}
                  />
                ))}
              </div>
              <span className="choice-label right">ê¸ì •</span>
            </div>

            <button
              className="next-button"
              onClick={handleNextQuestion}
              disabled={selectedValue === null}
            >
              {currentQuestion === TOTAL_QUESTIONS.length - 1 ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ ì§ˆë¬¸'}
            </button>
          </div>
        </main>

        {/* ì˜¤ë””ì˜¤ ì»¨íŠ¸ë¡¤ UI */}
        <div className="audio-controls">
          <button
            className={`audio-toggle ${isPlaying ? 'playing' : ''}`}
            onClick={togglePlay}
          >
            {isPlaying ? 'ìŒì•… ë„ê¸°' : 'ìŒì•… ì¼œê¸°'}
          </button>
          <div className="volume-control">
            <span className="volume-icon">ğŸ”Š</span>
            <input
              type="range"
              min="0"
              max="1"
              step="0.1"
              value={volume}
              onChange={handleVolumeChange}
              className="volume-slider"
            />
          </div>
        </div>
      </div>
    </>
  );
}

export default MbtiCyberPage;
